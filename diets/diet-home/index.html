<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
  <title>CoreAI Diet Dashboard!</title>
  <link rel="stylesheet" href="./style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://api.fontshare.com/v2/css?f[]=cal-sans@400,500,600&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <!-- Firebase Initialization -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAtBxeZrh4cej7ZzsKZ5uN-BqC_wxoTmdE",
      authDomain: "coreai-82c79.firebaseapp.com",
      databaseURL: "https://coreai-82c79-default-rtdb.firebaseio.com",
      projectId: "coreai-82c79",
      storageBucket: "coreai-82c79.firebasestorage.app",
      messagingSenderId: "97395011364",
      appId: "1:97395011364:web:1e8f6a06fce409bfd80db1",
      measurementId: "G-0J1RLMVEGC"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
  </script>

  <!-- OpenAI SDK -->
  <script src="https://cdn.jsdelivr.net/npm/openai@4.28.0/dist/index.min.js"></script>
  
  <!-- Other libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- Load our app script after Firebase is initialized -->
  <script src="./app.js" defer></script>
  
  <!-- Initialize auth check after app is loaded -->
  <script>
    class DietDashboard {
      constructor(user) {
        this.user = user;
        this.initialize();
      }

      async initialize() {
        // Initialize your dashboard functionality here
        console.log('Dashboard initialized for user:', this.user.email);
      }
    }

    // Initialize auth and check state
    firebase.auth().onAuthStateChanged((user) => {
      if (!user) {
        console.log('No user found, redirecting to login...');
        window.location.href = '../../index.html';
      } else {
        console.log('User authenticated:', user.email);
        // Initialize dashboard with the authenticated user
        window.dietDashboard = new DietDashboard(user);
      }
    });
  </script>
</head>