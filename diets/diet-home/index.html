<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
  <title>CoreAI Diet Dashboard!</title>
  <link rel="stylesheet" href="./style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://api.fontshare.com/v2/css?f[]=cal-sans@400,500,600&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  
  <!-- Firebase Initialization -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAtBxeZrh4cej7ZzsKZ5uN-BqC_wxoTmdE",
      authDomain: "coreai-82c79.firebaseapp.com",
      databaseURL: "https://coreai-82c79-default-rtdb.firebaseio.com",
      projectId: "coreai-82c79",
      storageBucket: "coreai-82c79.firebasestorage.app",
      messagingSenderId: "97395011364",
      appId: "1:97395011364:web:1e8f6a06fce409bfd80db1",
      measurementId: "G-0J1RLMVEGC"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
  </script>

  <!-- OpenAI SDK -->
  <script src="https://cdn.jsdelivr.net/npm/openai@4.28.0/dist/index.min.js"></script>
  
  <!-- Other libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  
  <!-- Load our app script after Firebase is initialized -->
  <script src="./app.js" defer></script>
  
  <!-- Initialize auth check after app is loaded -->
  <script>
    class DietDashboard {
      constructor(user) {
        this.user = user;
        this.initialize();
      }

      async initialize() {
        // Initialize your dashboard functionality here
        console.log('Dashboard initialized for user:', this.user.email);
      }
    }

    // Initialize auth and check state
    firebase.auth().onAuthStateChanged((user) => {
      if (!user) {
        console.log('No user found, redirecting to login...');
        window.location.href = '../../index.html';
      } else {
        console.log('User authenticated:', user.email);
        // Initialize dashboard with the authenticated user
        window.dietDashboard = new DietDashboard(user);
      }
    });
  </script>
</head>
<body>
  <div class="image-upload-area">
    <input type="file" 
           id="imageInput" 
           accept="image/*" 
           class="file-input">
    <div class="upload-content">
      <svg xmlns="http://www.w3.org/2000/svg" class="upload-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <p class="upload-text">Click to upload or drag and drop</p>
      <p class="upload-subtext">Supports: JPG, PNG, WEBP</p>
    </div>
  </div>

  <div id="image-preview" class="image-preview hidden">
    <img id="previewImg" src="" alt="Preview">
    <button onclick="window.dietDashboard.clearImage()" class="clear-button">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
      </svg>
    </button>
  </div>
</body>
</html>